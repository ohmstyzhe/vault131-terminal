<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VAULT 131 DATABASE</title>

<style>
html, body{
  margin:0; height:100%; background:#000;
  font-family: monospace;
  display:flex; justify-content:center; align-items:center;
  overflow:hidden;
}

#crt{
  width:90%;
  max-width:980px;
  height:80vh;
  background:#050b07;
  border-radius:22px;
  padding:34px;
  position:relative;
  overflow:hidden;
  display:flex;
  flex-direction:column;
  border:3px solid rgba(76,255,154,0.35);
  box-shadow:0 0 45px rgba(76,255,154,0.25), inset 0 0 140px rgba(0,0,0,0.95);
}

/* ===== HEADER ===== */
#uiWrap{
  margin-bottom:10px;
  padding-bottom:10px;
  border-bottom:1px solid rgba(76,255,154,0.3);
}
#uiTop{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  flex-wrap:wrap;
}
#uiBar{
  color:#4cff9a;
  font-size:14px;
  letter-spacing:1px;
  opacity:0.92;
}
#uiStatus{
  margin-top:6px;
  color:rgba(76,255,154,0.85);
  font-size:12px;
  letter-spacing:0.8px;
  opacity:0.9;
}

/* ===== AUDIO BUTTON ===== */
#audioBtn{
  border:2px solid rgba(76,255,154,0.55);
  background:transparent;
  color:rgba(76,255,154,0.85);
  font-family:monospace;
  padding:6px 10px;
  border-radius:6px;
  cursor:pointer;
  font-size:12px;
  letter-spacing:1px;
}
#audioBtn.on{
  border-color:#4cff9a;
  color:#4cff9a;
}

/* ===== TERMINAL ===== */
#terminal{
  color:#4cff9a;
  text-shadow:0 0 4px rgba(76,255,154,0.7),0 0 10px rgba(76,255,154,0.4);
  white-space:pre-wrap;
  overflow-y:auto;
  flex:1;
}

/* ===== INPUT ===== */
#inputBox{
  display:none;
  width:80%;
  margin-top:10px;
  background:rgba(0,0,0,0.6);
  color:#4cff9a;
  border:2px solid #4cff9a;
  padding:10px;
  border-radius:6px;
  font-size:16px;
  outline:none;
}

/* ===== BUTTONS / HINTS ===== */
#hintContainer{margin-top:6px;display:flex;flex-wrap:wrap;}
button{
  border:2px solid #4cff9a;
  background:transparent;
  color:#4cff9a;
  font-family:monospace;
  padding:6px 12px;
  margin:6px 6px 0 0;
  border-radius:6px;
  cursor:pointer;
}

/* ===== CURSOR ===== */
#cursor{
  display:inline-block;
  width:10px;
  background:#4cff9a;
  margin-left:2px;
  animation: blink 1s infinite;
}
@keyframes blink{50%{opacity:0;}}

/* ===== SCANLINES ===== */
#scanlines{
  position:absolute; inset:0;
  background:repeating-linear-gradient(to bottom,
    rgba(0,0,0,.28), rgba(0,0,0,.28) 1px,
    transparent 1px, transparent 3px);
  pointer-events:none;
  animation: scan 2s linear infinite;
}
@keyframes scan {from{background-position:0 0;}to{background-position:0 3px;}}

/* ===== POWER DIP / GLITCH OVERLAY ===== */
#powerDip{
  position:absolute;
  inset:0;
  background:radial-gradient(circle at 50% 45%,
    rgba(76,255,154,0.10),
    rgba(0,0,0,0.92) 60%,
    rgba(0,0,0,0.98) 100%);
  opacity:0;
  pointer-events:none;
  z-index:8;
  mix-blend-mode:screen;
}
.powerDipOn{
  animation: dip 420ms ease-in-out 1;
}
@keyframes dip{
  0%{opacity:0; filter:brightness(1) contrast(1);}
  20%{opacity:0.9; filter:brightness(0.65) contrast(1.25);}
  55%{opacity:0.35; filter:brightness(0.85) contrast(1.15);}
  100%{opacity:0; filter:brightness(1) contrast(1);}
}

/* ===== RAD FLICKER DURING LOADING ===== */
.radFlicker{ animation: rad 140ms steps(2) infinite; }
@keyframes rad{
  0%{filter:brightness(1) contrast(1);}
  50%{filter:brightness(0.92) contrast(1.18);}
  100%{filter:brightness(1) contrast(1);}
}

/* ===== LOADING ===== */
.loadTrack{
  width:100%;
  max-width:520px;
  height:12px;
  border:2px solid rgba(76,255,154,0.65);
  border-radius:6px;
  overflow:hidden;
  margin-top:8px;
}
.loadFill{height:100%; width:0%; background:rgba(76,255,154,0.95);}
.loadMsg{margin-top:6px;opacity:.95;}
.loadDetail{margin-top:4px;opacity:.82;font-size:13px;letter-spacing:0.5px;}

/* ===== FINAL CODE ===== */
.bigCode{
  font-size:56px;
  letter-spacing:10px;
  font-weight:700;
  text-align:center;
  margin-top:14px;
  text-shadow:
    0 0 6px rgba(76,255,154,0.9),
    0 0 18px rgba(76,255,154,0.6),
    0 0 32px rgba(76,255,154,0.35);
  animation: codeFlash 1.1s steps(2) infinite;
}
@keyframes codeFlash{
  0%{opacity:1;}
  50%{opacity:.35;}
  100%{opacity:1;}
}

/* ===========================
   PIP-BOY READY SCREEN (14-LOVE-READY)
   =========================== */
#pipboy{
  display:none;
  flex:1;
  position:relative;
  color:#4cff9a;
  text-shadow:0 0 4px rgba(76,255,154,0.6),0 0 10px rgba(76,255,154,0.25);
}

#pipTopBar{
  display:flex;
  align-items:center;
  gap:12px;
  padding:10px 12px;
  border:1px solid rgba(76,255,154,0.35);
  border-radius:12px;
  background:rgba(0,0,0,0.35);
  box-shadow: inset 0 0 60px rgba(0,0,0,0.65);
}

#pipTabs{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
.pipTab{
  padding:6px 10px;
  border:1px solid rgba(76,255,154,0.30);
  border-radius:10px;
  opacity:0.85;
}
.pipTab.active{
  border-color:rgba(76,255,154,0.75);
  box-shadow:0 0 10px rgba(76,255,154,0.15);
  opacity:1;
}

#pipSubTabs{
  margin-left:auto;
  display:flex;
  gap:10px;
  opacity:0.9;
  font-size:12px;
  letter-spacing:0.6px;
}
#pipSubTabs span{ opacity:0.85; }
#pipSubTabs span.active{ opacity:1; text-decoration:underline; }

#pipBody{
  margin-top:12px;
  flex:1;
  position:relative;
  border:1px solid rgba(76,255,154,0.25);
  border-radius:14px;
  background:rgba(0,0,0,0.20);
  box-shadow: inset 0 0 90px rgba(0,0,0,0.75);
  overflow:hidden;
  padding:14px;
}

#pipGrid{
  position:absolute;
  inset:14px;
  display:grid;
  grid-template-columns: 1fr 320px 1fr;
  grid-template-rows: 1fr 320px 1fr;
  align-items:center;
  justify-items:center;
  gap:14px;
}

#vaultBoyWrap{
  grid-column:2;
  grid-row:2;
  width:280px;
  height:280px;
  display:flex;
  align-items:center;
  justify-content:center;
  position:relative;
}

.tick{
  position:absolute;
  width:16px;
  height:4px;
  background:rgba(76,255,154,0.85);
  box-shadow:0 0 10px rgba(76,255,154,0.20);
  border-radius:2px;
}
.tick.t{top:18px; left:50%; transform:translateX(-50%);}
.tick.b{bottom:18px; left:50%; transform:translateX(-50%);}
.tick.l{left:14px; top:50%; transform:translateY(-50%);}
.tick.r{right:14px; top:50%; transform:translateY(-50%);}

#vaultSvg{
  width:240px;
  height:240px;
  opacity:0.95;
  filter: drop-shadow(0 0 10px rgba(76,255,154,0.20));
}

/* four “modules” around him */
.pipModule{
  width:min(260px, 92%);
  border:2px solid rgba(76,255,154,0.65);
  border-radius:12px;
  padding:10px 12px;
  background:rgba(0,0,0,0.35);
  cursor:pointer;
  text-align:left;
  letter-spacing:0.6px;
  box-shadow: inset 0 0 30px rgba(0,0,0,0.65);
}
.pipModule:hover{
  border-color:rgba(76,255,154,0.95);
  box-shadow:0 0 14px rgba(76,255,154,0.10), inset 0 0 30px rgba(0,0,0,0.65);
}
.pipModule small{
  display:block;
  margin-top:6px;
  opacity:0.85;
  font-size:12px;
  letter-spacing:0.4px;
}

#modInfo{grid-column:2; grid-row:1; align-self:end; justify-self:center;}
#modDate{grid-column:3; grid-row:2; justify-self:start; align-self:center;}
#modStory{grid-column:2; grid-row:3; align-self:start; justify-self:center;}
#modMystery{grid-column:1; grid-row:2; justify-self:end; align-self:center;}

/* bottom HUD like your pic */
#pipHud{
  position:absolute;
  left:14px; right:14px; bottom:14px;
  display:flex;
  gap:10px;
  align-items:center;
  justify-content:space-between;
  font-size:12px;
  letter-spacing:0.6px;
  padding:10px 12px;
  border:1px solid rgba(76,255,154,0.25);
  border-radius:12px;
  background:rgba(0,0,0,0.35);
}
.hudBlock{opacity:0.9;}
.hudBar{
  height:8px;
  width:180px;
  border:1px solid rgba(76,255,154,0.45);
  border-radius:10px;
  overflow:hidden;
}
.hudFill{
  height:100%;
  width:55%;
  background:rgba(76,255,154,0.85);
}

/* ===== POPUP PANEL ===== */
#pipPanel{
  display:none;
  position:absolute;
  inset:0;
  z-index:9;
  background:rgba(0,0,0,0.65);
  backdrop-filter: blur(2px);
  padding:18px;
}
#pipPanelBox{
  width:min(760px, 95%);
  height:min(520px, 90%);
  margin:0 auto;
  border:2px solid rgba(76,255,154,0.75);
  border-radius:14px;
  background:rgba(0,0,0,0.55);
  box-shadow: 0 0 25px rgba(76,255,154,0.12), inset 0 0 90px rgba(0,0,0,0.8);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
#pipPanelHead{
  padding:12px 14px;
  border-bottom:1px solid rgba(76,255,154,0.25);
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
#pipPanelTitle{
  font-size:14px;
  letter-spacing:1px;
  opacity:0.95;
}
#pipPanelClose{
  border:2px solid rgba(76,255,154,0.65);
  border-radius:10px;
  padding:6px 10px;
  background:transparent;
  color:#4cff9a;
  cursor:pointer;
}
#pipPanelBody{
  padding:14px;
  overflow:auto;
  white-space:pre-wrap;
  line-height:1.45;
  font-size:14px;
  opacity:0.95;
}

/* Mobile */
@media (max-width:720px){
  #inputBox{width:100%;}
  #pipGrid{
    grid-template-columns: 1fr 260px 1fr;
    grid-template-rows: 1fr 260px 1fr;
  }
  #vaultBoyWrap{width:240px;height:240px;}
  #vaultSvg{width:210px;height:210px;}
  .pipModule{width:min(220px, 92%); font-size:13px;}
  .hudBar{width:130px;}
}
</style>
</head>

<body>
<div id="crt">

  <div id="uiWrap">
    <div id="uiTop">
      <div id="uiBar">VAULT 131 DATABASE │ STATUS: LOCKED</div>
      <button id="audioBtn">AUDIO: OFF</button>
    </div>
    <div id="uiStatus">STANDBY… AWAITING INPUT</div>
  </div>

  <!-- TERMINAL MODE -->
  <div id="terminal"></div>
  <input id="inputBox" autocomplete="off">
  <div id="hintContainer"></div>

  <!-- PIP-BOY READY MODE -->
  <div id="pipboy">
    <div id="pipTopBar">
      <div id="pipTabs">
        <span class="pipTab active">STAT</span>
        <span class="pipTab">INV</span>
        <span class="pipTab">DATA</span>
        <span class="pipTab">MAP</span>
        <span class="pipTab">RADIO</span>
      </div>
      <div id="pipSubTabs">
        <span class="active">STATUS</span>
        <span>SPECIAL</span>
        <span>PERKS</span>
      </div>
    </div>

    <div id="pipBody">
      <div id="pipGrid">

        <div id="modInfo" class="pipModule">
          INFO
          <small>How this terminal was built</small>
        </div>

        <div id="modDate" class="pipModule">
          DATE DAY
          <small>Live countdown module</small>
        </div>

        <div id="modMystery" class="pipModule">
          HOLOTAPE
          <small>Confidential message</small>
        </div>

        <div id="modStory" class="pipModule">
          VAULT 131 LOG
          <small>Recovered story file</small>
        </div>

        <div id="vaultBoyWrap">
          <div class="tick t"></div>
          <div class="tick b"></div>
          <div class="tick l"></div>
          <div class="tick r"></div>

          <!-- Simple “Vault Boy-ish” SVG placeholder (works offline).
               If you later want a real Vault Boy PNG, we can swap to <img>. -->
          <svg id="vaultSvg" viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg" aria-label="Vault Boy">
            <g fill="none" stroke="rgba(76,255,154,0.95)" stroke-width="6" stroke-linecap="round" stroke-linejoin="round">
              <!-- head -->
              <circle cx="100" cy="62" r="28"/>
              <!-- hair swoop -->
              <path d="M80 52 C92 40, 118 40, 125 56"/>
              <!-- smile -->
              <path d="M90 70 C97 78, 110 78, 116 70"/>
              <!-- torso -->
              <path d="M100 90 L100 140"/>
              <path d="M80 108 C92 102, 108 102, 120 108"/>
              <!-- arms -->
              <path d="M80 110 L62 128"/>
              <path d="M120 110 L138 128"/>
              <!-- legs -->
              <path d="M100 140 L86 172"/>
              <path d="M100 140 L114 172"/>
              <!-- shoes -->
              <path d="M78 176 L95 176"/>
              <path d="M105 176 L122 176"/>
            </g>
          </svg>
        </div>

      </div>

      <div id="pipHud">
        <div class="hudBlock">STIMPAK (5)  &nbsp; RADAWAY (3)</div>
        <div class="hudBlock">HP 42/95</div>
        <div class="hudBlock">
          LEVEL 1
          <div class="hudBar"><div class="hudFill"></div></div>
        </div>
        <div class="hudBlock">AP 90/90</div>
      </div>

      <!-- Popup -->
      <div id="pipPanel">
        <div id="pipPanelBox">
          <div id="pipPanelHead">
            <div id="pipPanelTitle">MODULE</div>
            <button id="pipPanelClose">CLOSE</button>
          </div>
          <div id="pipPanelBody"></div>
        </div>
      </div>

    </div>
  </div>

  <div id="powerDip"></div>
  <div id="scanlines"></div>
</div>

<script>
/* ========= AUDIO (button-controlled; iPhone safe) ========= */
let audioOn = false;
const ctx = new (window.AudioContext||window.webkitAudioContext)();
const hum = ctx.createOscillator();
const gain = ctx.createGain();
hum.type = "sawtooth";
hum.frequency.value = 60;
gain.gain.value = 0;
hum.connect(gain);
gain.connect(ctx.destination);
hum.start();

function setHum(on){
  gain.gain.cancelScheduledValues(ctx.currentTime);
  gain.gain.linearRampToValueAtTime(on ? 0.02 : 0, ctx.currentTime + 0.25);
}
function beep(){
  if(!audioOn) return;
  const o = ctx.createOscillator(), g = ctx.createGain();
  o.connect(g); g.connect(ctx.destination);
  o.frequency.value = 880;
  g.gain.value = 0.03;
  o.start();
  o.stop(ctx.currentTime + 0.03);
}

const audioBtn = document.getElementById("audioBtn");
audioBtn.onclick = async ()=>{
  await ctx.resume();
  audioOn = !audioOn;
  setHum(audioOn);
  audioBtn.textContent = audioOn ? "AUDIO: ON" : "AUDIO: OFF";
  audioBtn.classList.toggle("on", audioOn);
};

/* ========= ELEMENTS ========= */
const crt = document.getElementById("crt");
const uiBar = document.getElementById("uiBar");
const uiStatus = document.getElementById("uiStatus");
const term = document.getElementById("terminal");
const input = document.getElementById("inputBox");
const hints = document.getElementById("hintContainer");
const dip = document.getElementById("powerDip");

const pipboy = document.getElementById("pipboy");
const pipPanel = document.getElementById("pipPanel");
const pipPanelTitle = document.getElementById("pipPanelTitle");
const pipPanelBody = document.getElementById("pipPanelBody");
const pipPanelClose = document.getElementById("pipPanelClose");

const cursor = document.createElement("span");
cursor.id="cursor";
term.appendChild(cursor);

/* ========= TYPEWRITER ========= */
function type(lines, speed=35, cb){
  let i=0;
  (function next(){
    if(i>=lines.length){ cb && cb(); return; }
    const d = document.createElement("div");
    term.insertBefore(d, cursor);
    let j=0;

    const prePause = (Math.random()<0.18) ? (180 + Math.random()*240) : 0;

    setTimeout(()=>{
      (function c(){
        if(j>=lines[i].length){
          i++;
          setTimeout(next, 260 + Math.random()*120);
          return;
        }
        d.textContent += lines[i][j++];
        beep();
        term.scrollTop = term.scrollHeight;
        setTimeout(c, speed + Math.random()*25);
      })();
    }, prePause);
  })();
}

/* ========= UI STATES ========= */
function setLocked(){ uiBar.textContent = "VAULT 131 DATABASE │ STATUS: LOCKED"; }
function setUnlocked(){ uiBar.textContent = "VAULT 131 DATABASE │ STATUS: OPERATIONAL │ USER: IZABELLA"; }
function setStatus(text){ uiStatus.textContent = text; }

/* ========= DATA ========= */
const ID = "101-317-76";
const NEXT_ID = "14-LOVE-READY";
const FINAL_CODE = "531";

const riddles = [
  { q:"I move without legs and follow you everywhere.", a:"shadow",
    h:["You see me when light hits you.","I copy your shape perfectly.","I disappear in darkness."] },
  { q:"The more you take, the more you leave behind.", a:"footsteps",
    h:["You make me without noticing.","I mark where you’ve been.","I vanish if you stop walking."] },
  { q:"I speak without a mouth and hear without ears.", a:"echo",
    h:["I repeat what you say.","I live in empty spaces.","You hear me after you call out."] },
  { q:"I’m always coming, but I never arrive.", a:"tomorrow",
    h:["You can’t hold me in your hands.","I’m always one day away.","It becomes today… then it’s gone."] },
  { q:"I have keys but open no locks. I have space but no room. You can enter, but you can’t go outside. What am I?",
    a:"keyboard",
    h:["Think: terminal.","You’re using me right now.","Keys + space + enter = me."] }
];

const finalQ = {
  q:"FINAL AUTHORIZATION REQUIRED.\n\nThis number marks the day everything changed.\nWhat is the code?",
  a: FINAL_CODE,
  h:["There were flowers.","You went to the beach.","Someone was running late… for a good reason."]
};

const loadMsgs = [
  "ACCESSING VAULT RECORDS…",
  "DECRYPTING MEMORY SECTORS…",
  "VERIFYING EMOTIONAL STABILITY…",
  "CHECKING RADIATION LEVELS…",
  "SYNCING PERSONAL DATA…",
  "VAULT-TEC PROTOCOL ACTIVE…",
  "AUTHORIZATION PENDING…",
  "BUFFERING… PLEASE WAIT…"
];

const loadDetails = [
  "LINK: VAULTNET/131 :: HANDSHAKE OK",
  "CACHE: REBUILDING INDEX TABLES",
  "SECURITY: HASHING CREDENTIALS",
  "I/O: CALIBRATING CONSOLE INPUT",
  "SYS: SCANNING FOR ANOMALIES",
  "MEM: FLUSHING TEMP BUFFERS",
  "DATA: CHECKSUM VALIDATION PASS",
  "COMMS: SIGNAL STRENGTH STABLE",
  "CORE: SPINNING UP MODULES",
  "VAULT-TEC: INTEGRITY 100%"
];

/* ========= STATE ========= */
let stage = "login";
let r = 0;
let hintUsed = 0;
let locked = false;
let countdownTimer = null;

/* ========= HELPERS ========= */
function clearTerminal(){
  term.innerHTML="";
  term.appendChild(cursor);
}
function showInput(ph=""){
  input.style.display="block";
  input.placeholder=ph;
  input.focus();
}
function hideInput(){ input.style.display="none"; }

function showHints(arr){
  hints.innerHTML="";
  for(let i=hintUsed;i<3;i++){
    const b = document.createElement("button");
    b.textContent = "HINT " + (i+1);
    b.onclick = ()=>{
      if(locked) return;
      setStatus("HINT MODULE: ACTIVE");
      type(["HINT: " + arr[i]], 30, ()=> setStatus("AWAITING INPUT…"));
      hintUsed++;
      showHints(arr);
    };
    hints.appendChild(b);
  }
}

/* ========= VIEW SWITCHING ========= */
function showTerminalView(){
  pipboy.style.display="none";
  term.style.display="block";
  input.style.display="none";
  hints.style.display="block";
}
function showPipboyView(){
  term.style.display="none";
  input.style.display="none";
  hints.style.display="none";
  pipboy.style.display="flex";
}

/* ========= POWER DIP ========= */
function powerDip(cb){
  dip.classList.remove("powerDipOn");
  void dip.offsetWidth;
  dip.classList.add("powerDipOn");
  setStatus("POWER FLUCTUATION… STABILIZING");
  setTimeout(()=>{
    setStatus("STABILITY: NOMINAL");
    cb && cb();
  }, 420);
}

/* ========= LOADING BAR + RAD FLICKER ========= */
function loading(cb){
  locked = true;
  hideInput();
  hints.innerHTML = "";
  setStatus("PROCESSING… PLEASE WAIT");

  const track = document.createElement("div");
  const fill = document.createElement("div");
  track.className="loadTrack";
  fill.className="loadFill";
  track.appendChild(fill);

  const msg = document.createElement("div");
  msg.className="loadMsg";

  const detail = document.createElement("div");
  detail.className="loadDetail";

  term.insertBefore(track, cursor);
  term.insertBefore(msg, cursor);
  term.insertBefore(detail, cursor);

  let p=0, mi=0, di=0;
  msg.textContent = loadMsgs[Math.floor(Math.random()*loadMsgs.length)];
  detail.textContent = loadDetails[Math.floor(Math.random()*loadDetails.length)];

  crt.classList.add("radFlicker");

  const msgI = setInterval(()=>{ msg.textContent = loadMsgs[mi++ % loadMsgs.length]; }, 650);
  const detI = setInterval(()=>{ detail.textContent = loadDetails[di++ % loadDetails.length]; }, 520);

  const t = setInterval(()=>{
    p += 2 + Math.floor(Math.random()*6);
    if(p>100) p=100;
    fill.style.width = p + "%";
    term.scrollTop = term.scrollHeight;

    if(p>=100){
      clearInterval(t);
      clearInterval(msgI);
      clearInterval(detI);

      setTimeout(()=>{
        track.remove(); msg.remove(); detail.remove();
        locked = false;
        crt.classList.remove("radFlicker");
        setStatus("READY");
        cb && cb();
      }, 240);
    }
  }, 60);
}

/* ========= EASTER EGG ========= */
function showHelp(){
  stage = "help";
  clearTerminal();
  setStatus("VAULT-TEC NOTICE");
  type([
    "VAULT-TEC INTERNAL MEMO // DO NOT DISTRIBUTE",
    "------------------------------------------",
    "",
    "If you are reading this, you are doing great.",
    "You are safe here.",
    "",
    "OPERATOR TIP:",
    "- HINT buttons are limited to 3 per question.",
    "- Answers are NOT case sensitive.",
    "",
    "To continue: press ENTER to return.",
  ], 30, ()=>{ showInput("PRESS ENTER"); });
}

/* ========= TERMINAL SCENES ========= */
function boot(){
  showTerminalView();
  stage="login";
  r=0;
  hintUsed=0;
  locked=false;

  setLocked();
  setStatus("STANDBY… AWAITING INPUT");
  clearTerminal();

  type([
    "VAULT 131 DATABASE",
    "SECURITY: ENABLED",
    "ENTER IDENTIFICATION:",
    "> "
  ], 35, ()=> showInput("ENTER ID"));
}

function askRiddle(){
  if(r >= riddles.length){
    stage="final";
    hintUsed=0;
    clearTerminal();
    setStatus("FINAL AUTHORIZATION");
    type([finalQ.q, "", "> "], 35, ()=>{
      showInput("ENTER CODE");
      showHints(finalQ.h);
      setStatus("AWAITING FINAL INPUT…");
    });
    return;
  }

  stage="riddle";
  hintUsed=0;
  clearTerminal();
  setStatus(`TEST MODULE ${r+1}/5 LOADED`);
  type([`RIDDLE ${r+1}: ${riddles[r].q}`, "", "> "], 35, ()=>{
    showInput("TYPE ANSWER");
    showHints(riddles[r].h);
    setStatus("AWAITING INPUT…");
  });
}

function showFinalSuccess(){
  clearTerminal();
  setStatus("AUTHORIZATION GRANTED");
  type([
    "AUTHORIZATION GRANTED.",
    "",
    "CASE CODE:",
    ""
  ], 35, ()=>{
    const big = document.createElement("div");
    big.className="bigCode";
    big.textContent = FINAL_CODE;
    term.insertBefore(big, cursor);
    term.scrollTop = term.scrollHeight;

    setTimeout(()=>{
      setStatus("POST-AUTH SEQUENCE");
      type([
        "",
        "Use it to open the briefcase on the bed.",
        "",
        "NEXT ACCESS UNLOCKED.",
        `NEW LOGIN CODE: ${NEXT_ID}`,
        "",
        "To use it:",
        "1) Reload this page",
        "2) At the ID prompt, enter that code",
        "",
        "Happy Valentine’s Day, Izabella.",
        "I love you so much — I hope you enjoy today.",
      ], 32, ()=>{
        const btn = document.createElement("button");
        btn.textContent = "RETURN TO MAIN MENU";
        btn.onclick = boot;
        term.insertBefore(btn, cursor);
        term.scrollTop = term.scrollHeight;
        setStatus("SESSION COMPLETE");
      });
    }, 520);
  });
}

/* ========= PIP-BOY READY SCREEN ========= */
function openPanel(title, body){
  pipPanelTitle.textContent = title;
  pipPanelBody.textContent = body;
  pipPanel.style.display="block";
}
function closePanel(){
  pipPanel.style.display="none";
}
pipPanelClose.onclick = closePanel;
pipPanel.onclick = (e)=>{ if(e.target === pipPanel) closePanel(); };

function getValentineTarget(){
  // Next Feb 14 at 12:00 PM local time
  const now = new Date();
  let year = now.getFullYear();
  const target = new Date(year, 1, 14, 12, 0, 0);
  if(now > target) target.setFullYear(year + 1);
  return target;
}

function formatCountdown(ms){
  if(ms <= 0) return "00d 00h 00m 00s";
  const s = Math.floor(ms/1000);
  const days = Math.floor(s/86400);
  const hrs = Math.floor((s%86400)/3600);
  const mins = Math.floor((s%3600)/60);
  const secs = s%60;
  const pad = (n)=> String(n).padStart(2,"0");
  return `${pad(days)}d ${pad(hrs)}h ${pad(mins)}m ${pad(secs)}s`;
}

function showReadyPipboy(){
  stage="ready";
  setUnlocked();
  setStatus("NEXT ADVENTURE UNLOCKED");
  showPipboyView();
  closePanel();

  // Module text
  const infoText =
`VAULT 131 // SYSTEM INFO
-----------------------
Estimated build time: 3–6 hours (plus the "why is it frozen" minutes).

Terminal stack (in nerd language):
- Single-file static site (HTML/CSS/JS)
- Event-driven state machine (login → riddles → final)
- Typewriter renderer with jitter + cursor
- AudioContext oscillator hum + per-keystroke beeps
- Faux CRT: scanlines + phosphor glow + power dip

Security note:
This terminal uses a "soft lock" design.
Meaning: it looks scary, but it’s here to guide you — not punish you.`;

  const storyText =
`VAULT 131 // RECOVERED LOG (CLASSIFIED)
--------------------------------------
They sold it as “a happiness experiment.”

Vault 131 wasn’t built to survive bombs. It was built to survive *loneliness*.

On Day 1, every resident received a wrist-tag and a small list of “Objectives.”
Not chores. Not rules.
Objectives.

“Say something kind to a stranger.”
“Trade something you love for something you need.”
“Write down a memory you don’t want to lose.”

At first, everyone laughed. Vault-Tec always had a gimmick.

But Vault 131’s real trick wasn’t the Objectives.
It was the terminals.

Each terminal had a hidden prompt that only unlocked when the user answered a sequence of riddles.
Vault-Tec claimed it measured intelligence under stress.
The Overseer claimed it measured *compatibility*.

The truth?
It measured honesty.

Because the last question wasn’t about facts —
it was about a date.

A day you’d never forget.
A day your brain could replay even in the dark.

They wanted proof that the human heart could become a key.

Weeks turned into months.
People stopped yelling.
Stopped hoarding.
Stopped pretending they were fine.

They started leaving notes in the terminals —
not official messages, but little sparks:

“Thanks for the radaway.”
“Sorry for earlier.”
“You matter here.”

And then, one night, the power dipped.
The lights flickered into that sick green glow.
The entire vault froze in silence…

…except for the terminals.

Across Vault 131, screens woke up in unison.

VAULT-TEC PROTOCOL: RECONNECTION

Residents received a new Objective:
“Find the person you’d choose in the wasteland.
Tell them.”

Some people panicked.
Some people ran.
Some people pretended it was a prank.

But a handful of them did it.
They walked up, voice shaking, and said the thing that makes time stop.

And for the first time since the doors sealed,
Vault 131 felt like it was built for the right reason.

Not survival.

But *belonging.*

End of log.

(Press CLOSE to return.)`;

  const mysteryText =
`HOLOTAPE // “GOOD LUCK, IZABELLA”
---------------------------------
If you’re reading this, that means you made it.

And I just want you to know something:

Even in the worst wasteland day…
even in the dumbest stress…
even when the world feels loud and weird…

You are my safe place.

NEW QUEST OBJECTIVE:
1) Smile. You earned it.
2) Keep this secret.
3) On Valentine’s Day — trust me.

Reward: A day made for you.`;

  // Countdown module uses live data each open
  function openCountdown(){
    const target = getValentineTarget();
    const now = new Date();
    const ms = target - now;

    const prettyDate = target.toLocaleString(undefined, {
      weekday:"long", month:"long", day:"numeric", year:"numeric",
      hour:"numeric", minute:"2-digit"
    });

    openPanel("DATE DAY // COUNTDOWN", 
`Target: ${prettyDate}

Time remaining:
${formatCountdown(ms)}

(Keep this panel open to watch it tick.)`);

    // live tick while panel open
    if(countdownTimer) clearInterval(countdownTimer);
    countdownTimer = setInterval(()=>{
      if(pipPanel.style.display !== "block") { clearInterval(countdownTimer); countdownTimer=null; return; }
      const ms2 = getValentineTarget() - new Date();
      const lines = pipPanelBody.textContent.split("\n");
      // update the countdown line block
      pipPanelBody.textContent =
`Target: ${prettyDate}

Time remaining:
${formatCountdown(ms2)}

(Keep this panel open to watch it tick.)`;
    }, 250);
  }

  document.getElementById("modInfo").onclick = ()=> openPanel("INFO // SYSTEM", infoText);
  document.getElementById("modStory").onclick = ()=> openPanel("VAULT 131 LOG", storyText);
  document.getElementById("modMystery").onclick = ()=> openPanel("HOLOTAPE", mysteryText);
  document.getElementById("modDate").onclick = ()=> openCountdown();

  // Quick “return” instruction in status
  setStatus("STATUS: READY │ Tap a module. Press ENTER to return.");
}

/* ========= INPUT HANDLING ========= */
input.addEventListener("keydown", (e)=>{
  if(e.key !== "Enter") return;
  if(locked) return;

  const raw = input.value.trim();
  const a = raw.toLowerCase();

  input.value = "";
  hideInput();
  hints.innerHTML = "";

  // HELP Easter egg anywhere
  if(a === "help"){ showHelp(); return; }
  if(stage === "help"){ boot(); return; }

  if(stage === "login"){
    setStatus("VALIDATING…");

    if(a === ID.toLowerCase()){
      setUnlocked();
      clearTerminal();
      type(["ID VERIFIED.","Welcome, Izabella.","Initializing test modules…"], 35, ()=>{
        loading(()=> powerDip(()=> { r=0; askRiddle(); }));
      });
      return;
    }

    if(a === NEXT_ID.toLowerCase()){
      showReadyPipboy();
      return;
    }

    type(["✖ INVALID ID", "> "], 35, ()=>{
      setStatus("ACCESS DENIED");
      showInput("ENTER ID");
    });
    return;
  }

  if(stage === "riddle"){
    if(a === riddles[r].a.toLowerCase()){
      setStatus("ANSWER ACCEPTED");
      type(["✔ CORRECT."], 30, ()=>{
        loading(()=> powerDip(()=>{
          r++;
          askRiddle();
        }));
      });
    } else {
      setStatus("ANSWER REJECTED");
      type(["✖ TRY AGAIN", "> "], 30, ()=>{
        showInput("TYPE ANSWER");
        showHints(riddles[r].h);
        setStatus("AWAITING INPUT…");
      });
    }
    return;
  }

  if(stage === "final"){
    if(raw === finalQ.a){
      setStatus("CODE ACCEPTED");
      type(["✔ AUTHORIZED."], 30, ()=>{
        loading(()=> powerDip(()=> showFinalSuccess()));
      });
    } else {
      setStatus("CODE INVALID");
      type(["✖ INCORRECT CODE", "> "], 30, ()=>{
        showInput("ENTER CODE");
        showHints(finalQ.h);
        setStatus("AWAITING FINAL INPUT…");
      });
    }
    return;
  }

  // In ready Pip-Boy screen: pressing Enter returns to boot
  if(stage === "ready"){
    boot();
    return;
  }
});

/* ALSO allow Enter while Pip-Boy is visible (no input box) */
document.addEventListener("keydown", (e)=>{
  if(e.key !== "Enter") return;
  if(stage !== "ready") return;
  // If a panel is open, close it first. Otherwise return to boot.
  if(pipPanel.style.display === "block"){ closePanel(); return; }
  boot();
});

/* Start */
boot();
</script>
</body>
</html>